# Домашнее задание к занятию 12.8 "Резервное копирование баз данных" Ефимов А.А.
---

### Задание 1. Резервное копирование
### Кейс

Финансовая компания решила увеличить надежность работы БД и их резервного копирования.

Необходимо описать, какие варианты резервного копирования подходят в случаях:

1.1 Необходимо восстанавливать данные в полном объеме за предыдущий день. Делать полную копию по заданию раз в день

1.2 Необходимо восстанавливать данные за час до предполагаемой поломки. Делать инкрементную копию от полной каждый час

1.3* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую/починеную БД? Путем размещения БД в облачном сервисе. Облачная база данных или DBaaS (Database as a Service).
Приведите ответ в свободной форме.

---

### Задание 2. PostgreSQL

2.1 С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

Создание резервных копий
Базовая команда
Синтаксис:

pg_dump <параметры> <имя базы> > <файл, куда сохранить дамп>

Пример:

pg_dump users > /tmp/users.dump

Пользователь и пароль
Если резервная копия выполняется не от учетной записи postgres, необходимо добавить опцию -U с указанием пользователя:

pg_dump -U dmosk -W users > /tmp/users.dump

* где dmosk — имя учетной записи; опция W потребует ввода пароля.
Восстановление
Базовая команда
Синтаксис:

psql <имя базы> < <файл с дампом>

Пример:

psql users < /tmp/users.dump

С авторизацией
При необходимости авторизоваться при подключении к базе вводим:

psql -U dmosk -W users < /tmp/users.dump

* где dmosk — имя учетной записи; опция W потребует ввода пароля.

2.1* Возможно ли автоматизировать этот процесс? Если да, то как? Через скрипт автоматизировать создания резервных копий, добавить в планировщик заданий. При срабатывании тригера на метрику в системе мониторинга запускать скрипт на восстановление. При этом переходить на реплику. Затем догнать восстановленую БД с реплики.
Приведите ответ в свободной форме.

---

### Задание 3. MySql

3.1 С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySql.
Инкрементное резервное копирование с помощью утилиты Persona XtraBackup:
Cначала создаем полный бэкап,затем от него инкрементный. Возможно делать инкрементный от инкрементного, но это не надежно.
Percona XtraBackup — это утилита для горячего резервного копирования баз данных MySQL. Во время создания резервной копии данных не происходит блокирования таблиц, ваша система продолжает работать без каких бы то ни было ограничений. XtraBackup 2.4 может создавать резервные копии таблиц InnoDB, XtraDB и MyISAM на серверах MySQL 5.11, 5.5, 5.6 и 5.7, а также на сервере Percona для MySQL с XtraDB

xtrabackup --backup --target-dir=/home/backup2/ --datadir=/var/lib/mysql/
xtrabackup --backup --incremental-basedir=/home/backup2 --target-dir=/home/incr1 --datadir=/var/lib/mysql

---
